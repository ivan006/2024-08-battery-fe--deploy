const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.js","js/vendor.js","css/vendor.css","css/index.css"])))=>i.map(i=>d[i]);
import{bc as K,bd as j,be as H,r as p,e as r,j as n,k as m,w as u,a1 as g,ab as v,c as h,aa as S,m as C,at as q,av as z,aw as U,n as y,bf as Q,s as _,x,bg as P,V as J,W as Y,bh as W,v as V,D as Z,p as L,l as B,a5 as M,_ as D,Y as X}from"./vendor.js";import{_ as F,R as E,d as R,D as $,e as T,Q as k,f as ee,g as te,h as ae,i as le,j as ie,k as re,l as se,m as oe,n as ne,o as de,H as A}from"./index.js";const me="data:image/svg+xml,%3csvg%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2043%2043'%20width='43px'%20height='43px'%20%3e%3ccircle%20fill='%23ef3061'%20cx='21.5'%20cy='21.5'%20r='11.5'%20/%3e%3cpath%20d='%20M%2035.988887394336025%2017.617714323462188%20A%2015%2015,%200,%200,%201,%2025.382285676537812%2035.988887394336025%20M%2017.617714323462188%2035.988887394336025%20A%2015%2015,%200,%200,%201,%207.011112605663973%2017.617714323462195%20M%2010.893398282201785%2010.893398282201789%20A%2015%2015,%200,%200,%201,%2032.10660171779821%2010.893398282201785%20'%20stroke='%23ef3061'%20stroke-width='3'%20stroke-linecap='round'%20fill='transparent'%20opacity='0.7'%20/%3e%3cpath%20d='%20M%2041.5%2021.5%20A%2020%2020,%200,%200,%201,%2031.5%2038.82050807568877%20M%2011.500000000000004%2038.82050807568878%20A%2020%2020,%200,%200,%201,%201.5%2021.500000000000004%20M%2011.499999999999991%204.1794919243112325%20A%2020%2020,%200,%200,%201,%2031.5%204.179491924311229%20'%20stroke='%23ef3061'%20stroke-width='3'%20stroke-linecap='round'%20fill='transparent'%20opacity='0.4'%20/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%20width='24px'%20height='24px'%20className='flex'%20%3e%3cpath%20fill='%23fbfbfb'%20d='M454.848,198.848c0,159.225-179.751,306.689-179.751,306.689c-10.503,8.617-27.692,8.617-38.195,0c0,0-179.751-147.464-179.751-306.689C57.153,89.027,146.18,0,256,0S454.848,89.027,454.848,198.848z'%20/%3e%3cpath%20fill='%23ef3061'%20d='M454.848,198.848c0,159.225-179.751,306.689-179.751,306.689c-10.503,8.617-27.692,8.617-38.195,0c0,0-179.751-147.464-179.751-306.689C57.153,89.027,146.18,0,256,0S454.848,89.027,454.848,198.848z'%20/%3e%3cpath%20fill='%23fbfbfb'%20d='M256,298.89c-55.164,0-100.041-44.879-100.041-100.041S200.838,98.806,256,98.806s100.041,44.879,100.041,100.041S311.164,298.89,256,298.89z'%20/%3e%3c/svg%3e",ue={name:"MyGoogleMap",components:{InocanGoogleMap:K,InocanMarker:j,InocanMarkerCluster:H},props:{markers:{type:Array,default(){return[]}},modelValue:{type:Object,default(){return{}}},zoom:{type:Number,default(){return 2}}},data(){return{selectedPlaceIndex:null,VITE_API_GOOGLE_MAP_KEY:"AIzaSyAENUjZ_P7ulkAcDb-U8Htn6VSv_ioEKWEx",iconAndLabelLabel:{icon:{url:me},label:{color:"white"}}}},computed:{clusterStyles(){return[{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40}]}},methods:{iconAndLabelLabelMethod(e){return{icon:this.iconAndLabelLabel.icon,label:{text:String(e),...this.iconAndLabelLabel.label}}},clusterOptions(e){return{renderer:{render:({count:a,position:t})=>new e.Marker({position:t,...this.iconAndLabelLabelMethod(a),zIndex:999+a})}}},markerOptions(e){return{url:G,size:{width:30,height:30,f:"px",b:"px"},scaledSize:{width:30,height:30,f:"px",b:"px"}}},selectedMarkerOptions(e){return{id:e.meta.id,url:G,size:{width:40,height:40,f:"px",b:"px"},scaledSize:{width:40,height:40,f:"px",b:"px"}}},markerOptionsMethod(e,a){return a===this.selectedPlaceIndex?this.selectedMarkerOptions(e):this.markerOptions(e)},position(e){return{lng:Number(e.lng),lat:Number(e.lat)}},clickedMarker(e,a){this.$emit("update:modelValue",e.position),this.selectedPlaceIndex=a,this.$emit("clickMarker",e,a)}}};function ce(e,a,t,s,i,l){const c=p("InocanMarker"),o=p("InocanMarkerCluster"),d=p("InocanGoogleMap");return r(),n("div",null,[m(d,{"api-key":i.VITE_API_GOOGLE_MAP_KEY,center:t.modelValue,zoom:t.zoom,"map-type-id":"roadmap",style:{height:"calc(100vh - 100px)",width:"100%"}},{default:u(({api:f})=>[m(o,{options:l.clusterOptions(f)},{default:u(()=>[(r(!0),n(g,null,v(t.markers,(b,w)=>(r(),h(c,{key:w,onClick:O=>l.clickedMarker(b,w),options:{position:b.position,icon:l.markerOptionsMethod(b,w)}},null,8,["onClick","options"]))),128))]),_:2},1032,["options"])]),_:1},8,["api-key","center","zoom"])])}const pe=F(ue,[["render",ce],["__file","MyGoogleMap.vue"]]),he={name:"SuperTableGrid",components:{RecordFieldsForDisplayGeneric:E,RecordFieldsForDisplayCustom:R},props:{loading:{type:Boolean,default(){return!1}},excludedCols:{type:Array,default(){return[]}},unClickable:{type:Boolean,default(){return!1}},templateListGrid:{type:Object,default(){return{}}},items:{type:Array,default(){return[]}},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},methods:{colClasses(e=12){e=+e;const a={lg:1,md:1.5,sm:2,xs:4};function t(o){return[1,2,3,4,6,12].reduce((f,b)=>Math.abs(b-o)<Math.abs(f-o)?b:f)}const s=t(e*a.lg),i=t(e*a.md),l=t(e*a.sm),c=t(e*a.xs);return`col-${s} col-lg-${s} col-md-${i} col-sm-${l} col-xs-${c}`},deleteItem(e){this.$emit("deleteItem",e)},editItem(e){this.$emit("editItem",e)},clickRow(e){this.$emit("clickRow",e[this.superOptions.model.primaryKey],e)}}},fe={key:0,class:"text-center q-pa-md"},ye={key:1,class:"text-center q-pa-md text-grey-5"},ge={key:1,class:"row q-col-gutter-md justify-center"},be={class:"q-card q-mx-auto",style:{height:"100%",overflow:"hidden"}},Ie={key:1,class:S("col-12 col-md-3 ")},ke={class:"q-card q-mx-auto",style:{height:"100%"}};function Ce(e,a,t,s,i,l){const c=p("RecordFieldsForDisplayCustom"),o=p("RecordFieldsForDisplayGeneric");return r(),n("div",null,[t.items.length?(r(),n("div",ge,[(r(!0),n(g,null,v(t.items,d=>(r(),n(g,{key:d.name},[t.templateListGrid&&t.templateListGrid.cols?(r(),n("div",{key:0,class:S(l.colClasses(t.templateListGrid.colWidth?t.templateListGrid.colWidth:3))},[C("div",be,[m(c,{item:d,onClickRow:l.clickRow,maxFields:6,childRelations:[],isSummary:"",superOptions:t.superOptions,template:t.templateListGrid,onEditItem:l.editItem,onDeleteItem:l.deleteItem,unClickable:t.unClickable||!t.superOptions.model.rules.readable(d)},null,8,["item","onClickRow","superOptions","template","onEditItem","onDeleteItem","unClickable"])])],2)):(r(),n("div",Ie,[C("div",ke,[m(o,{item:d,onClickRow:l.clickRow,maxFields:6,superOptions:t.superOptions,onEditItem:l.editItem,onDeleteItem:l.deleteItem,unClickable:t.unClickable},null,8,["item","onClickRow","superOptions","onEditItem","onDeleteItem","unClickable"])])]))],64))),128))])):(r(),n(g,{key:0},[t.loading?(r(),n("div",fe,"Loading...")):(r(),n("div",ye,"None"))],64))])}const Fe=F(he,[["render",Ce],["__file","SuperTableGrid.vue"]]),we={name:"SuperTableTable",components:{DatapointForDisplay:$,DatapointForDisplayInner:T},props:{hidePagination:{type:Boolean,default(){return!1}},templateListTable:{type:Object,default(){return{}}},items:{type:Array,default(){return[]}},options:{type:Object,default(){return{}}},itemsLength:{type:Number,default(){return null}},loading:{type:Boolean,default(){return!1}},loadingError:{type:Boolean,default(){return!1}},excludedCols:{type:Array,default(){return[]}},model:{type:[Object,Function],required:!0},displayMapField:{type:Boolean,required:!1},canEdit:{type:Boolean,required:!1}},data(){return{sortBy:[],pagination:{page:1,rowsPerPage:10,sortBy:[],descending:!1}}},computed:{superOptions(){return{headers:this.headers,modelFields:this.modelFields,displayMapField:this.displayMapField,model:this.model,canEdit:this.canEdit}},headers(){return k.SupaerTableHeaders(this.model,this.excludedCols,this.canEdit,this.displayMapField)},modelFields(){return k.computedAttrs(this.model,this.excludedCols)},pKey(){return this.superOptions.model.primaryKey},optionsComputed:{get(){return this.options},set(e){this.$emit("update:options",e)}},flattenedHeaders(){let e=[];if(this.templateListTable.length)for(const a of this.templateListTable){const t=this.superOptions.headers.find(i=>i.field===a.field);let s={};if(typeof t!="undefined")s=t,typeof a.label!="undefined"&&(s.label=a.label),s.userConfig=a;else{let i="";typeof a.label!="undefined"&&!a.hideLabel&&(i=a.label);let l="";typeof a.field!="undefined"&&(l=a.field),s={align:"left",dataType:"attr",field:l,label:i,meta:{},name:l,sortable:!!l.length,usageType:"normal",userConfig:a}}e.push(s)}else for(const a of this.superOptions.headers)if(a.usageType!=="relChildrenNormal"&&(e.push(a),a.headerParentFields))for(const t of a.headerParentFields)t.meta.important&&e.push({...t,userConfig:{}});return e},flattenedHeadersHideMapField(){let e=[];for(const a of this.flattenedHeaders)(!a.meta||!a.meta.hideField)&&(this.superOptions.superOptions||!a.usageType.startsWith("relLookupMapExtra")&&!a.usageType.startsWith("mapExtra"))&&e.push(a);return e}},methods:{tableRowClassFn(e){let a="ccc";return this.model.rules.readable(e.row)&&(a="hhh"),a},updateOptions(e){this.$emit("update:options",e)},deleteItem(e){this.$emit("deleteItem",e)},editItem(e){this.$emit("editItem",e)},clickRow(e){this.model.rules.readable(e)&&this.$emit("clickRow",e[this.model.primaryKey],e)},onRequest(e){const{page:a,rowsPerPage:t,sortBy:s,descending:i}=e.pagination;this.pagination={...this.pagination,page:a,rowsPerPage:t,sortBy:s,descending:i},this.$emit("update:options",{page:a,rowsPerPage:t,sortBy:s,descending:i})}},watch:{options:{handler(e){var a,t;this.pagination={...this.pagination,page:e.page,rowsPerPage:e.itemsPerPage,sortBy:((a=e.sortBy[0])==null?void 0:a.key)||this.pKey,descending:((t=e.sortBy[0])==null?void 0:t.order)==="desc"||!1}},deep:!0},"editItemData.showModal"(e){e||(this.editItemData.data={})}},mounted(){this.sortBy=[{key:this.pKey,order:"asc"}]}},_e={key:0},xe={key:1},ve={key:0,class:"text-center q-pa-md"},Oe={key:1,class:"text-center q-pa-md text-grey-5"},Se={key:2,class:"text-center q-pa-md text-grey-5"};function Me(e,a,t,s,i,l){const c=p("DatapointForDisplay");return r(),n("div",null,[t.items.length?(r(),h(U,{key:0,"table-row-class-fn":l.tableRowClassFn,class:"qTable",rows:t.items,columns:l.flattenedHeadersHideMapField,"row-key":"id","rows-per-page-options":[10,20,30,50,100],pagination:i.pagination,loading:t.loading,onRequest:l.onRequest,hideBottom:t.hidePagination},{body:u(o=>[m(q,{props:o,onClick:d=>l.clickRow(o.row),"no-hover":!t.model.rules.readable(o.row)},{default:u(()=>[(r(!0),n(g,null,v(l.flattenedHeaders,d=>(r(),h(z,{key:d.field,props:o},{default:u(()=>[d.isChildOf?(r(),n("div",_e,[m(c,{item:o.row[d.isChildOf.value],superOptions:l.superOptions,childRelations:[],dataPoint:d.userConfig,header:d,hideLabel:"",onEditItem:l.editItem,onDeleteItem:l.deleteItem,protectImage:""},null,8,["item","superOptions","dataPoint","header","onEditItem","onDeleteItem"])])):(r(),n("div",xe,[m(c,{item:o.row,superOptions:l.superOptions,childRelations:[],dataPoint:d.userConfig,header:d,hideLabel:"",onEditItem:l.editItem,onDeleteItem:l.deleteItem,protectImage:""},null,8,["item","superOptions","dataPoint","header","onEditItem","onDeleteItem"])]))]),_:2},1032,["props"]))),128))]),_:2},1032,["props","onClick","no-hover"])]),_:1},8,["table-row-class-fn","rows","columns","pagination","loading","onRequest","hideBottom"])):y("",!0),t.items.length?y("",!0):(r(),n(g,{key:1},[t.loading?(r(),n("div",ve,"Loading...")):t.loadingError?(r(),n("div",Oe,"Loading Error")):(r(),n("div",Se,"None"))],64))])}const De=F(we,[["render",Me],["__scopeId","data-v-b445e39c"],["__file","SuperTableTable.vue"]]),Ee={name:"SuperTableMap",components:{RecordFieldsForDisplayCustom:R,DatapointForDisplayInner:T,MyGoogleMap:pe,RecordFieldsForDisplayGeneric:E},props:{templateListGrid:{type:Object,default(){return{}}},unClickable:{type:Boolean,default(){return!1}},items:{type:Array,default(){return[]}},mapHeaders:{type:Array,default(){return[]}},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},data(){return{locationHasBeenGranted:!1,zoom:2,geolocation:Q(),center:{lat:0,lng:0},geoLocate:{},selectedPlaceIndex:null,clusterStyle:{textColor:"white",url:"/mapIconCluster.svg",anchorText:[1.5,1]},viewItemData:{showModal:!1,data:{}}}},computed:{clusterStyles(){return[{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40},{...this.clusterStyle,height:40,width:40}]},markers(){let e=[],a=this.mapHeaders.find(s=>s.usageType=="mapExtraGeoLocLong"),t=this.mapHeaders.find(s=>s.usageType=="mapExtraGeoLocLat");if(t&&a)for(const s of this.items)[null,""].includes(s[t.name])||e.push({position:{lat:+s[t.name],lng:+s[a.name]},keys:{long:a.name,lat:t.name},meta:s});else{let s="";for(const i of this.mapHeaders)if(s=i.field,i.headerParentFields&&(a=i.headerParentFields.find(l=>l.usageType=="mapExtraGeoLocLong"),t=i.headerParentFields.find(l=>l.usageType=="mapExtraGeoLocLat"),t&&a))break;if(t&&a)for(const i of this.items)i[t.name]!==null&&e.push({position:{lat:i[s][t.name],lng:i[s][a.name]},keys:{long:a.name,lat:t.name},meta:i})}return e}},methods:{deleteItem(e){this.$emit("deleteItem",e)},editItem(e){this.$emit("editItem",e)},clickRow(e){this.viewItemData.showModal=!1,this.$emit("clickRow",e[this.superOptions.model.primaryKey],e)},position(e){return{lng:Number(e.lng),lat:Number(e.lat)}},positionString(e){return e.lat+", "+e.lng},markerOptionsMethod(e,a){return a==this.selectedPlaceIndex?this.selectedMarkerOptions(e,a):this.markerOptions(e,a)},clickedMarker(e,a){this.viewItemData.showModal=!0,this.viewItemData.data=e.meta,this.selectedPlaceIndex=a},markerOptions(e){return{id:e.meta.id,url:"/mapIconPin.svg",size:{width:30,height:30,f:"px",b:"px"},scaledSize:{width:30,height:30,f:"px",b:"px"}}},selectedMarkerOptions(e){return{id:e.meta.id,url:"/mapIconPin.svg",size:{width:40,height:40,f:"px",b:"px"},scaledSize:{width:40,height:40,f:"px",b:"px"}}}},mounted(){},watch:{"geolocation.coords.latitude"(){if(!this.locationHasBeenGranted){this.locationHasBeenGranted=!0,this.center={lng:this.geolocation.coords.longitude,lat:this.geolocation.coords.latitude};let e=2;this.geolocation.coords.accuracy<=100||this.geolocation.coords.altitude?e=9:this.geolocation.coords.accuracy<=1e3?e=8:e=7,this.zoom=e}}}},Re={key:0,class:"text-center q-pa-md"};function Te(e,a,t,s,i,l){const c=p("MyGoogleMap"),o=p("RecordFieldsForDisplayCustom"),d=p("RecordFieldsForDisplayGeneric");return r(),n("div",null,[m(_,{class:"q-pa-xs"},{default:u(()=>[l.markers.length?y("",!0):(r(),n("div",Re," None ")),l.markers.length?(r(),h(c,{key:1,markers:l.markers,modelValue:i.center,"onUpdate:modelValue":a[0]||(a[0]=f=>i.center=f),zoom:i.zoom,onClickMarker:l.clickedMarker},null,8,["markers","modelValue","zoom","onClickMarker"])):y("",!0)]),_:1}),m(x,{modelValue:i.viewItemData.showModal,"onUpdate:modelValue":a[1]||(a[1]=f=>i.viewItemData.showModal=f),"max-width":"800px"},{default:u(()=>[m(_,{class:"q-pa-none"},{default:u(()=>[t.templateListGrid&&t.templateListGrid.cols?(r(),h(o,{key:0,item:i.viewItemData.data,maxFields:6,childRelations:[],isSummary:"",superOptions:t.superOptions,template:t.templateListGrid,onEditItem:l.editItem,onDeleteItem:l.deleteItem,unClickable:t.unClickable||!t.superOptions.model.rules.readable(i.viewItemData.data),onClickRow:l.clickRow},null,8,["item","superOptions","template","onEditItem","onDeleteItem","unClickable","onClickRow"])):(r(),h(d,{key:1,item:i.viewItemData.data,maxFields:6,superOptions:t.superOptions,onEditItem:l.editItem,onDeleteItem:l.deleteItem,unClickable:t.unClickable,onClickRow:l.clickRow},null,8,["item","superOptions","onEditItem","onDeleteItem","unClickable","onClickRow"]))]),_:1})]),_:1},8,["modelValue"])])}const Pe=F(Ee,[["render",Te],["__file","SuperTableMap.vue"]]),Ve={name:"SuperTableList",components:{RecordFieldsForDisplayCustom:R,DatapointForDisplayInner:T},props:{items:{type:Array,default(){return[]}},modelValue:{type:Number,default:null},superOptions:{type:Object,default(){return{headers:[],modelFields:[],displayMapField:!1,model:{},canEdit:!1,currentParentRecord:{}}}}},methods:{clickRow(e){this.$emit("update:modelValue",e.id)},deleteItem(e){this.$emit("deleteItem",e)},editItem(e){this.$emit("editItem",e)}},computed:{title(){return this.superOptions.headers.find(e=>e.field!=="id")}}},Le={style:{"max-height":"330px","overflow-y":"scroll"}};function Be(e,a,t,s,i,l){const c=p("DatapointForDisplayInner");return r(),n("div",Le,[m(W,{dense:""},{default:u(()=>[m(P,{header:"","model-value":t.modelValue,color:"primary"},{default:u(()=>[(r(!0),n(g,null,v(t.items,(o,d)=>(r(),h(J,{key:d,value:o.id,onClick:f=>l.clickRow(o)},{default:u(()=>[m(Y,null,{default:u(()=>[m(P,null,{default:u(()=>[m(c,{header:l.title,item:o,onEditItem:l.editItem,onDeleteItem:l.deleteItem},null,8,["header","item","onEditItem","onDeleteItem"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["model-value"])]),_:1})])}const Ae=F(Ve,[["render",Be],["__file","SuperTableList.vue"]]),Ge=M(()=>D(()=>import("./index.js").then(e=>e.u),__vite__mapDeps([0,1,2,3]))),Ne={name:"CrudModal",components:{CreateEditForm:Ge},props:{canEdit:!1,superOptions:{},parentKeyValuePair:{},templateForm:{}},data(){return{submitting:!1,formServerErrors:{},deleteItemData:{showModal:!1,data:null},editItemData:{showModal:!1,data:null},createItemData:{showModal:!1,data:{}}}},methods:{createNewInstance(){return new this.superOptions.model},createItem(){this.createItemData.showModal=!0},createItemSubmit(){if(this.submitting)return;this.submitting=!0;let e=k.preparePayload(this.createItemData.data,this.superOptions.modelFields);delete e.id;let a={};this.superOptions.modelFields.find(s=>s.usageType=="fileImageType")&&(a={"Content-Type":"multipart/form-data"}),this.superOptions.model.Store({...e,...this.createPayloadExtras},[],{},a).then(s=>{var i;(i=this.superOptions.model.hooks)!=null&&i.createComplete&&this.superOptions.model.hooks.createComplete(s),this.submitting=!1,this.$emit("fetchData"),this.$emit("createdItem",s.response.data.data),this.createItemData.data={},this.createItemData.showModal=!1,this.formServerErrors={}}).catch(s=>{this.submitting=!1,this.formServerErrors=s.response.data})},deleteItem(e){this.$emit("deleteItem",e),this.deleteItemData.data=e,this.deleteItemData.showModal=!0},deleteItemSubmit(){this.superOptions.model.Delete(this.deleteItemData.data.id).then(()=>{this.$emit("fetchData"),this.deleteItemData.showModal=!1,this.$emit("deleteComplete")}).catch(e=>{this.$emit("deleteComplete")})},editItem(e){this.$emit("editItem",e),this.editItemData.data={...e},this.editItemData.showModal=!0},editItemSubmit(){const e=k.preparePayload(this.editItemData.data,this.superOptions.modelFields);this.superOptions.model.Update(e,[],{},{"Content-Type":"multipart/form-data"}).then(()=>{this.$emit("fetchData"),this.editItemData.showModal=!1,this.formServerErrors={},this.$emit("editComplete")}).catch(a=>{this.formServerErrors=a.response.data,this.$emit("editComplete")})}},watch:{"createItemData.showModal"(e){e&&(this.createItemData.data=this.createNewInstance(),this.parentKeyValuePair.parentFKey&&this.parentKeyValuePair.parentFVal&&(this.createItemData.data[this.parentKeyValuePair.parentFKey]=this.parentKeyValuePair.parentFVal))}}},Ke=C("div",{class:"text-h6"},"Delete Item",-1),je=C("p",null,"Are you sure you want to delete this item?",-1);function He(e,a,t,s,i,l){const c=p("CreateEditForm");return r(),n("div",null,[t.superOptions.canEdit?(r(),n(g,{key:0},[m(x,{modelValue:i.createItemData.showModal,"onUpdate:modelValue":[a[2]||(a[2]=o=>i.createItemData.showModal=o),a[3]||(a[3]=o=>{i.formServerErrors={}})]},{default:u(()=>[i.createItemData.showModal?(r(),h(c,{key:0,titlePrefix:"New",modelValue:i.createItemData.data,"onUpdate:modelValue":a[0]||(a[0]=o=>i.createItemData.data=o),onSubmit:l.createItemSubmit,onCancel:a[1]||(a[1]=o=>{i.createItemData.showModal=!1,i.formServerErrors={}}),superOptions:t.superOptions,style:{width:"700px","max-width":"calc(-32px + 100vw)"},template:t.templateForm,formServerErrors:i.formServerErrors,submitting:i.submitting},null,8,["modelValue","onSubmit","superOptions","template","formServerErrors","submitting"])):y("",!0)]),_:1},8,["modelValue"]),t.superOptions.canEdit?(r(),n(g,{key:0},[m(x,{modelValue:i.editItemData.showModal,"onUpdate:modelValue":[a[6]||(a[6]=o=>i.editItemData.showModal=o),a[7]||(a[7]=o=>{i.formServerErrors={}})]},{default:u(()=>[i.editItemData.showModal?(r(),h(c,{key:0,titlePrefix:"Edit",modelValue:i.editItemData.data,"onUpdate:modelValue":a[4]||(a[4]=o=>i.editItemData.data=o),onSubmit:l.editItemSubmit,onCancel:a[5]||(a[5]=o=>{i.editItemData.showModal=!1,i.formServerErrors={}}),superOptions:t.superOptions,template:t.templateForm,style:{width:"700px","max-width":"calc(-32px + 100vw)"},formServerErrors:i.formServerErrors,submitting:i.submitting},null,8,["modelValue","onSubmit","superOptions","template","formServerErrors","submitting"])):y("",!0)]),_:1},8,["modelValue"]),m(x,{modelValue:i.deleteItemData.showModal,"onUpdate:modelValue":a[9]||(a[9]=o=>i.deleteItemData.showModal=o)},{default:u(()=>[m(_,{style:{width:"500px","max-width":"calc(-32px + 100vw)"}},{default:u(()=>[m(V,{class:"q-pt-md q-pb-md q-pl-md q-pr-md"},{default:u(()=>[Ke]),_:1}),m(V,null,{default:u(()=>[je]),_:1}),m(Z,{align:"right"},{default:u(()=>[m(L,{onClick:a[8]||(a[8]=o=>i.deleteItemData.showModal=!1),flat:""},{default:u(()=>[B("Cancel")]),_:1}),m(L,{onClick:l.deleteItemSubmit,color:"negative",flat:""},{default:u(()=>[B("Delete")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)):y("",!0)],64)):y("",!0)])}const qe=F(Ne,[["render",He],["__file","CrudModal.vue"]]),ze=M(()=>D(()=>import("./index.js").then(e=>e.u),__vite__mapDeps([0,1,2,3]))),Ue=M(()=>D(()=>Promise.resolve().then(()=>$e),void 0)),Qe={name:"SuperTable",components:{SuperTableTopBar:ee,CrudModal:qe,SuperCalendar:te,PdfTemplate:ae,SearchGooglePlace:le,RecordFieldsForDisplayGeneric:E,RelationComponent:ie,CreateButton:re,DestructableExpansionPanels:se,FilterPlace:oe,FilterTime:ne,SuperSelect:de,SuperTableList:Ae,SuperTableMap:Pe,SuperTableTable:De,SuperTableGrid:Fe,CreateEditForm:ze,SuperTable:Ue},props:{titleVal:{type:String,default:""},downloadables:{type:Object,default:{}},noBorder:{type:Boolean,default:!1},justCreateButton:{type:Boolean,default:!1},createButtonText:{type:String,default:""},disabled:{type:Boolean,default:!1},allowedFilters:{type:Array,default:null},allowAll:{type:Boolean,default:!1},hideLabel:{type:Boolean,default(){return!1}},templateForm:{type:Object,default(){return{}}},viewAs:{type:Object,default(){return{show:["table","grid","map","calendar"],default:"table"}}},hideCreate:{type:Boolean,default(){return!1}},filterVals:{type:Object,default(){return{}}},filterNames:{type:Object,default(){return{}}},templateListTable:{type:Object,default(){return{}}},templateListGrid:{type:Object,default(){return{}}},templateListCalendar:{type:Object,default(){return{}}},model:{type:[Object,Function],required:!0},hidePagination:{type:Boolean,default(){return!1}},displayMapField:{type:Boolean,default(){return!1}},isForSelectingRelation:{type:Boolean,default(){return!1}},modelValue:{type:[Number,Object,String],default(){return null}},showMap:{type:Boolean,default(){return!1}},unClickable:{type:Boolean,default(){return!1}},parentKeyValuePair:{type:Object,default(){return{}}},createPayloadExtras:{type:Object,default(){return{}}},relationships:{type:Array,default(){return[]}},fetchFlags:{type:Object,default(){return{}}},defaultViewModeProp:{type:String,default(){return""}},rules:{type:Array,default(){return[()=>!0]}},modelField:{type:Object,default:()=>({})},errorMessage:{type:String,default(){return null}},selectHideBottomSpace:{type:Boolean,default(){return!1}}},data(){return{loadingError:!1,search:"",years:Array.from({length:5},(e,a)=>new Date().getFullYear()-a),itemsLength:1,activated:!1,loading:!1,options:{page:1,itemsPerPage:10,sortBy:[],groupBy:[]},highlightedRow:null,filterValsRef:{},filterNamesRef:{},items:[],activeTab:""}},computed:{longField(){return this.mapHeaders.find(a=>a.usageType=="mapExtraGeoLocLong")},startFieldName(){return A.getFieldFromModelOrParent(this.superOptions.headers,"timeRangeStart")},endFieldName(){return A.getFieldFromModelOrParent(this.superOptions.headers,"timeRangeEnd")},parentField(){return this.superOptions.modelFields.find(a=>a.name==this.parentKeyValuePair.parentFKey)},canCreateComputed(){if(this.parentField&&typeof this.parentField.fieldExtras.linkablesRule=="function"){const e=this.parentField.fieldExtras.linkablesRule();if(e[this.model.primaryKey]&&this.parentKeyValuePair.parentFVal&&!e[this.model.primaryKey].split(",").map(Number).includes(this.parentKeyValuePair.parentFVal))return!1}return!0},superOptions(){return{headers:this.headers,modelFields:this.modelFields,displayMapField:this.displayMapField,model:this.model,canEdit:this.canEdit}},excludedCols(){let e=[];return this.parentKeyValuePair.parentFKey&&(e=[this.parentKeyValuePair.parentFKey]),e},canEdit(){return this.model.rules.creatable()},filterValsComp(){const e={...this.filterValsRef};return this.parentKeyValuePair.parentFKey&&this.parentKeyValuePair.parentFVal&&(e[this.parentKeyValuePair.parentFKey]=this.parentKeyValuePair.parentFVal),e},headers(){return k.SupaerTableHeaders(this.model,this.excludedCols,this.canEdit,this.displayMapField)},mapHeaders(){return k.SupaerTableHeaders(this.model,this.excludedCols,this.canEdit,!0)},modelFields(){return k.computedAttrs(this.model,this.excludedCols)},pKey(){return this.model.primaryKey},maxPages(){return Math.ceil(this.itemsLength/this.options.itemsPerPage)}},methods:{createItem(){this.$refs.CrudModalRef.createItem()},deleteItem(e){this.$emit("deleteItem",e),this.$refs.CrudModalRef.deleteItem(e)},editItem(e){this.$emit("editItem",e),this.$refs.CrudModalRef.editItem(e)},doSearch(e){this.filterValsRef[this.model.titleKey]=e,this.fetchData()},pageUpdate(e){this.options={...this.options,page:e},this.fetchData()},updatePagination(e){this.options={...this.options,page:e.page,itemsPerPage:e.rowsPerPage,sortBy:e.sortBy,descending:e.descending},this.fetchData()},quickListsGetIfMatchesAllChecks(e,a){return k.quickListsGetIfMatchesAllChecks(e,a)},clickRow(e,a){this.isForSelectingRelation?this.highlightedRow=e:this.model.rules.readable(a)&&(typeof this.model.openRecord=="function"?this.model.openRecord(a[this.pKey],a,this.$router):this.$emit("clickRow",e,a,this.$router)),this.$emit("update:modelValue",e);let t=null;e&&(t=a[this.model.titleKey]),this.$emit("update:titleVal",t)},createdItem(e){this.isForSelectingRelation&&(this.$emit("update:modelValue",e[this.superOptions.model.primaryKey]),this.$refs.selectRef.hidePopup())},applyFilters(e,a){const t={};return Object.keys(a).forEach(s=>{const[i,l]=s.split(".");t[i]||(t[i]={}),t[i][l]=a[s]}),e.filter(s=>Object.keys(t).every(i=>{const l=t[i];return s[i]?s[i].some(c=>Object.keys(l).every(o=>c[o]===l[o])):!1}))},async fetchData(){var e,a,t,s,i;try{if(!this.activated&&this.isForSelectingRelation)return;this.loading=!0,this.loadingError=!1;let l=[];(e=this.model.rules)!=null&&e.readables&&(l=this.model.rules.readables());let c={},o={};this.model.adapter=="supabase"?(c={Prefer:"count=exact"},o={order:"id.desc"}):this.model.adapter=="laravel"&&(c={},o={sort:`-${this.model.primaryKey}`,per_page:this.options.itemsPerPage,page:this.options.page});const d=await this.model.FetchAll(this.relationships,{...l,...o,...this.fetchFlags},c,{page:this.options.page,limit:this.options.itemsPerPage,filters:this.filterValsComp,clearPrimaryModelOnly:!1});this.items=d.response.data.data,this.loading=!1;let f=0;this.model.adapter=="supabase"?(t=(a=d==null?void 0:d.response)==null?void 0:a.headers)!=null&&t["content-range"]&&(f=((i=(s=d==null?void 0:d.response)==null?void 0:s.headers)==null?void 0:i["content-range"]).split("/")[1]):this.model.adapter=="laravel"&&(f=d.response.data.total),this.itemsLength=f,this.$emit("fetchComplete",this.model.name,this.items)}catch{this.loading=!1,this.loadingError=!0}},activateAndFetchData(){!this.activated&&!this.disabled&&(this.activated=!0,this.fetchData())}},watch:{items(e){e.length&&this.$emit("update:items",e)},search(e){this.disabled||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.doSearch(e)},300))},filterVals:{handler(e,a){JSON.stringify(e)!==JSON.stringify(a)&&(this.isForSelectingRelation&&(this.activated=!1),this.items=[],this.filterValsRef=JSON.parse(JSON.stringify(e)))},deep:!0},filterValsRef:{handler(e,a){!this.loading&&!this.justCreateButton&&this.fetchData(),this.$emit("update:filterVals",e)},deep:!0}},mounted(){k.bindDeepPropToRef(this,[{prop:"filterNames",refName:"filterNamesRef"}]),this.$emit("superTableMounted"),this.activeTab=this.viewAs.default,(this.activated||!this.isForSelectingRelation)&&(this.justCreateButton||this.fetchData())}},Je={class:""},Ye={class:"flex flex-center"},We={key:1,class:""};function Ze(e,a,t,s,i,l){const c=p("CreateButton"),o=p("SuperSelect"),d=p("SuperTableTopBar"),f=p("SuperTableTable"),b=p("SuperTableGrid"),w=p("SuperTableMap"),O=p("SuperCalendar"),N=p("CrudModal");return r(),n("div",null,[t.justCreateButton?(r(),n(g,{key:1},[l.superOptions.model.rules.creatable()&&l.canCreateComputed&&!t.hideCreate?(r(),h(c,{key:0,modelFields:l.modelFields,onCreateItem:l.createItem,model:t.model,superOptions:l.superOptions,template:t.templateForm,createButtonText:t.createButtonText},null,8,["modelFields","onCreateItem","model","superOptions","template","createButtonText"])):y("",!0)],64)):(r(),n(g,{key:0},[t.isForSelectingRelation?(r(),h(o,{key:0,ref:"selectRef",readonly:t.disabled,allowAll:t.allowAll,dense:"",hideLabel:t.hideLabel,page:i.options.page,"onUpdate:page":l.pageUpdate,maxPages:l.maxPages,onClick:l.activateAndFetchData,items:i.items,loading:i.loading,rules:t.rules,modelValue:t.modelValue,"onUpdate:modelValue":l.clickRow,titleVal:t.titleVal,model:t.model,modelField:t.modelField,activated:i.activated,onSearch:l.doSearch,errorMessage:t.errorMessage,hideBottomSpace:t.selectHideBottomSpace},{default:u(()=>[l.superOptions.model.rules.creatable()&&l.canCreateComputed&&!t.hideCreate?(r(),h(c,{key:0,modelFields:l.modelFields,onCreateItem:l.createItem,model:t.model,superOptions:l.superOptions,template:t.templateForm,createButtonText:t.createButtonText},null,8,["modelFields","onCreateItem","model","superOptions","template","createButtonText"])):y("",!0)]),_:1},8,["readonly","allowAll","hideLabel","page","onUpdate:page","maxPages","onClick","items","loading","rules","modelValue","onUpdate:modelValue","titleVal","model","modelField","activated","onSearch","errorMessage","hideBottomSpace"])):(r(),n(g,{key:1},[m(d,{modelValue:i.filterValsRef,"onUpdate:modelValue":a[0]||(a[0]=I=>i.filterValsRef=I),filterNames:i.filterNamesRef,"onUpdate:filterNames":a[1]||(a[1]=I=>i.filterNamesRef=I),activeTab:i.activeTab,"onUpdate:activeTab":a[2]||(a[2]=I=>i.activeTab=I),search:i.search,"onUpdate:search":a[3]||(a[3]=I=>i.search=I),ref:"SuperTableTopBar",superOptions:l.superOptions,viewAs:t.viewAs,downloadables:t.downloadables,noBorder:t.noBorder,canCreateComputed:l.canCreateComputed,canEdit:l.canEdit,hideCreate:t.hideCreate,isForSelectingRelation:t.isForSelectingRelation,startFieldName:l.startFieldName,longField:l.longField,allowedFilters:t.allowedFilters,templateListTable:t.templateListTable,templateForm:t.templateForm,onCreateItem:l.createItem},null,8,["modelValue","filterNames","activeTab","search","superOptions","viewAs","downloadables","noBorder","canCreateComputed","canEdit","hideCreate","isForSelectingRelation","startFieldName","longField","allowedFilters","templateListTable","templateForm","onCreateItem"]),C("div",Je,[i.activeTab=="table"?(r(),n(g,{key:0},[C("div",null,[t.noBorder?(r(),h(f,{key:1,items:i.items,loading:i.loading,onClickRow:l.clickRow,templateListTable:t.templateListTable,hidePagination:t.hidePagination,excludedCols:l.excludedCols,model:t.model,displayMapField:t.displayMapField,canEdit:l.canEdit,onEditItem:l.editItem,onDeleteItem:l.deleteItem,loadingError:i.loadingError},null,8,["items","loading","onClickRow","templateListTable","hidePagination","excludedCols","model","displayMapField","canEdit","onEditItem","onDeleteItem","loadingError"])):(r(),h(_,{key:0,class:""},{default:u(()=>[m(f,{ref:"SuperTableTableRef",items:i.items,loading:i.loading,onClickRow:l.clickRow,templateListTable:t.templateListTable,hidePagination:t.hidePagination,excludedCols:l.excludedCols,model:t.model,displayMapField:t.displayMapField,canEdit:l.canEdit,onEditItem:l.editItem,onDeleteItem:l.deleteItem,loadingError:i.loadingError},null,8,["items","loading","onClickRow","templateListTable","hidePagination","excludedCols","model","displayMapField","canEdit","onEditItem","onDeleteItem","loadingError"])]),_:1}))]),C("div",Ye,[!t.hidePagination&&i.items.length?(r(),h(X,{key:0,class:S(["q-mt-sm",t.noBorder?"q-mx-md":""]),modelValue:i.options.page,"onUpdate:modelValue":[a[4]||(a[4]=I=>i.options.page=I),l.pageUpdate],max:l.maxPages,input:""},null,8,["class","modelValue","onUpdate:modelValue","max"])):y("",!0)])],64)):y("",!0),i.activeTab=="grid"?(r(),n("div",We,[m(b,{items:i.items,onClickRow:l.clickRow,superOptions:l.superOptions,unClickable:t.unClickable,templateListGrid:t.templateListGrid,onEditItem:l.editItem,onDeleteItem:l.deleteItem,excludedCols:l.excludedCols,loading:i.loading},null,8,["items","onClickRow","superOptions","unClickable","templateListGrid","onEditItem","onDeleteItem","excludedCols","loading"])])):y("",!0),i.activeTab=="map"?(r(),h(w,{key:2,mapHeaders:l.mapHeaders,items:i.items,onClickRow:l.clickRow,superOptions:l.superOptions,onEditItem:l.editItem,onDeleteItem:l.deleteItem,unClickable:t.unClickable,templateListGrid:t.templateListGrid},null,8,["mapHeaders","items","onClickRow","superOptions","onEditItem","onDeleteItem","unClickable","templateListGrid"])):y("",!0),i.activeTab=="calendar"?(r(),n(g,{key:3},[t.noBorder?(r(),h(O,{key:1,onClickRow:l.clickRow,onEditItem:l.editItem,onDeleteItem:l.deleteItem,loading:i.loading,mixedConfigs:[{templateListCalendar:t.templateListCalendar,startFieldName:l.startFieldName,endFieldName:l.endFieldName,items:i.items,superOptions:l.superOptions,unClickable:t.unClickable}]},null,8,["onClickRow","onEditItem","onDeleteItem","loading","mixedConfigs"])):(r(),h(_,{key:0,class:"q-pa-sm"},{default:u(()=>[m(O,{onClickRow:l.clickRow,onEditItem:l.editItem,onDeleteItem:l.deleteItem,loading:i.loading,mixedConfigs:[{templateListCalendar:t.templateListCalendar,startFieldName:l.startFieldName,endFieldName:l.endFieldName,items:i.items,superOptions:l.superOptions,unClickable:t.unClickable}]},null,8,["onClickRow","onEditItem","onDeleteItem","loading","mixedConfigs"])]),_:1}))],64)):y("",!0)])],64))],64)),m(N,{templateForm:t.templateForm,onFetchData:l.fetchData,onCreatedItem:l.createdItem,ref:"CrudModalRef",superOptions:l.superOptions,parentKeyValuePair:t.parentKeyValuePair},null,8,["templateForm","onFetchData","onCreatedItem","superOptions","parentKeyValuePair"])])}const Xe=F(Qe,[["render",Ze],["__file","SuperTable.vue"]]),$e=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"}));export{qe as C,Xe as S,De as a,$e as b};
